#docker 启动
docker run -p 39013:39013 -p 8090:8090 -p 39017:39017 -p 39041-39045:39041-39045 -p 1128-1129:1128-1129 -p 59013-59014:59013-59014 --ulimit nofile=1048576:1048576 --sysctl kernel.shmmax=1073741824 --sysctl net.ipv4.ip_local_port_range='40000 60999' --sysctl kernel.shmall=8388608 --name hana saplabs/hanaexpress --master-password Password@won-cloud321 --agree-to-sap-license
#查看用户组
SELECT * FROM "SYS"."USERGROUPS";
#创建用户组
CREATE USERGROUP DEFAULT;
#创建用户
CREATE USER "zmg" PASSWORD 'Apom@321' NO FORCE_FIRST_PASSWORD_CHANGE SET USERGROUP DEFAULT;
#连接 并且测试是否可以连接
hdbsql -j -A -sslprovider openssl -u ZMG -p Apom@321 -Z traceFile=stdout -Z traceOptions=debug=warning,flush=on -n 172.16.43.1:39017 "SELECT CURRENT_USER, CURRENT_SCHEMA FROM DUMMY;"
#证书连接
hdbsql -j -A -sslprovider openssl -Z authenticationMethods=x509 -Z authenticationX509=test_x509_user.pem -Z traceFile=stdout -Z traceOptions=debug=error,flush=on -n 172.16.43.1:39017  "SELECT * FROM "SYS"."USERGROUPS";"



创建根证书
openssl genrsa -out demorootca.key 4096
openssl req -x509 -new -nodes -key demorootca.key -sha256 -days 365 -subj "/CN=172.16.43.1/ST=ON" -out demorootca.crt

创建用户证书
openssl genrsa -out test_x509_user.key 2048
openssl req -new -nodes -key test_x509_user.key -out test_x509_user.csr -subj "/CN=172.16.43.1"
openssl x509 -req -in test_x509_user.csr -CA demorootca.crt -CAkey demorootca.key -CAcreateserial -days 365 -out test_x509_user.crt


openssl verify -CAfile demorootca.crt test_x509_user.crt
openssl x509 -text -noout -in test_x509_user.crt

//创建证书
CREATE CERTIFICATE X509_USER_CERT FROM '-----BEGIN CERTIFICATE-----
                                        MIIECTCCAfGgAwIBAgIUKdjjH6jXU1Mpmg0x9jDj4MK8MqcwDQYJKoZIhvcNAQEL
                                        BQAwIzEUMBIGA1UEAwwLMTcyLjE2LjQzLjExCzAJBgNVBAgMAk9OMB4XDTI1MTAy
                                        MDA3MDExMVoXDTI2MTAyMDA3MDExMVowFjEUMBIGA1UEAwwLMTcyLjE2LjQzLjEw
                                        ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCn37lsgZN5G+6849BitFX6
                                        lPQA5cUOE4bvkqM5gCIHwC24LOzHjpH1ILMs/risycXIcjsi93RBuhkBVoI3+tcB
                                        YpAiBMvlm19v00Unnk+iF5RTsuSENlSpj0u7kqkLP8Fzpu81ud4/vMDIiodbQYik
                                        ZlzCuMae589K1QTggkh02VordFkOPjBU450EXI3mnbstKQp9atPm2+s0kWVG6kc5
                                        5KtF8aOoKshfP8p4Kro9OoD36n0ituxjMehv0XA4bd9sU7CLLhslcwyaXCHlHfVi
                                        9jfAuV72TNEPVRP468NjbwSkp842tNKfBbLvqlokbnNpU5Hi2f5QXb6n57Lm4N8J
                                        AgMBAAGjQjBAMB0GA1UdDgQWBBQWyb2mM1YrjqRdpOSo/I9Ia3sSmzAfBgNVHSME
                                        GDAWgBSQb3Yv9PU2kgq3WAd/lB2Vlfl1WjANBgkqhkiG9w0BAQsFAAOCAgEAk9Rm
                                        pf52tMaRmaNYvCL5Y5vxQvOO44gOKlCAUSuD5p5ePy4wgKZPr8ndUTrIclYWTcqK
                                        HKqfPRtGA8b6Uj0I9oPT5CSuudakrXckgWzOhHPmmHgyXhe4tkJRyj+o416UxskG
                                        dvWpjTgnCoHrTi1/nQuGw40fIMDC0qOlesx9PXGzBx7IUZQapmQ8vI9ShxvUrIpM
                                        Sq0Xc4NeC4FBetNePN5Qxvp8uOcprQ6asr/xrHTEPtWQLXqQb92qJjk8Et7KETim
                                        BVuXtysrbvT9IBLFJbpSm0d9gvzqgQDuFjmccLSI/DO9RSkJuNTVV8VuPdbR/nOL
                                        xdRuXaWr6oYXvprS0nJ8yiFqwQK6CgIgnEOGeO7BU6zeEg7Zrtz7B956ywwTXrv2
                                        1T5ch9WIuW4+cpIl7iWnUhxx1YaCKoHd36f0bYUoIZHA7b3cQKifCLhnzVLFMQ9k
                                        mBFnRwbnOGnWdAQ6i62eV+VWDXw0os+TRZrik+u73GapA28qkRCuV6/iCgE4N8YB
                                        GeEU1GcIbCZxl9knPy93fvtayatmtbJjm46a/3MH0aPeemwjwQVsq5xydF2Ci31F
                                        Iw26U/wlGGzc2pfHL0abJOeo7uBE99TyW1bQRnSpEYtf4Gxkmu4xqohGYf7k80NL
                                        wpFF4Msz/VdSfhB66N8ALgE5Jc5pTrrWm2kgwpY=
                                        -----END CERTIFICATE-----';

SELECT CERTIFICATE_NAME, SUBJECT_DISTINGUISHED_NAME, ISSUER_DISTINGUISHED_NAME, ISSUER_COMMON_NAME FROM CERTIFICATES WHERE CERTIFICATE_NAME='X509_USER_CERT';


CREATE CERTIFICATE DEMOROOTCA_CERT FROM '-----BEGIN CERTIFICATE-----
                                         MIIFJzCCAw+gAwIBAgIUJr49UlbLbs2nVgoIQOZmIkW4ZNowDQYJKoZIhvcNAQEL
                                         BQAwIzEUMBIGA1UEAwwLMTcyLjE2LjQzLjExCzAJBgNVBAgMAk9OMB4XDTI1MTAy
                                         MDA3MDEwMloXDTI2MTAyMDA3MDEwMlowIzEUMBIGA1UEAwwLMTcyLjE2LjQzLjEx
                                         CzAJBgNVBAgMAk9OMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAqXIV
                                         zDxn9uAIIpLG3ngIws08a4hu6b7wStH5wQzLWJNRJ8Drj17nWqn2RXIpb0OFjdPm
                                         bTqnYoYGdRD42pk1bOtJrO8hpy8MaTLaLRKSvxA5cr43d1khpeLBUo1M+HH3xsM+
                                         46MqLmsZcIyPkrxvvL8dcj8t5KR4n3rPj5ir841Ku9PpgDD+VQhY/CyeVmww/p5e
                                         2T84hqg7CnuOn/sr0iPz4K7tVTiXMxO9XVnRr/MGMmg4zNlKGeDzUgu63XGix21+
                                         /dwZ5pPOO1Gzcus2DUnmouqg8yCrdQYBcCYi4Mrx/dMMx1+1WtISp+Z+J0neM/Ls
                                         wfEgRt/HVdUO4Z4pwMtIRxX2PPrOUr8/KKFK8+S/fsaUKtiqbyHLmXAb1c1zfpMb
                                         D2ftbrR4GbiDUbKh4RhFLV76lhl3rGMuH0I1UFzkWvRORB1UtauUYVBWTtfIOzv8
                                         47t8JK0R8bNZs1vADykc1mCYKF5banqVZ0Xle4RP40+hh3OYxwysKcHqeVxr8dZl
                                         bSekrfWh5GyaJbWfbXEO4UnekvJzI78TuTQzvAgSCMR2sLSCVQmDY3H1Dsj/mD2z
                                         MMabMQMN6LLSi9zSGHrt5Q7ROlJlNPMlnj1VdMRWZrpSNdIWSLPBDwCoC5WcnLBf
                                         JxmRghZdXCOZe8bqJr2k6BoRnhZOcH1XpdA0jO0CAwEAAaNTMFEwHQYDVR0OBBYE
                                         FJBvdi/09TaSCrdYB3+UHZWV+XVaMB8GA1UdIwQYMBaAFJBvdi/09TaSCrdYB3+U
                                         HZWV+XVaMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggIBAHZoo1Sf
                                         Ey10MTlF+3cdK4jrv+TwZ1fqxYY58HklJC7vyKW94qt6sAwveahPxDQrHi99MknB
                                         rVeTKfgSapX/nNyM+h7NR87Mefu3fFfOKEzbX+oL4OVCyyamohSPeggDIynaDqFT
                                         G0qiYpZRwPiYR2tYj05tr1SUM6wCpfwNr7SBKEVdIwf8IA5+se7aW+Vlytn7zl9W
                                         fDQzZRtYr0bWpueATMuaUKPLpRMl23Ol5mi/GCXpZBY2aQFRy3xmzJl7kTm5YfiY
                                         4z6eSkv5w5KKVcjvQ1H+0QhyGkXvvr4JA9fxpU/dl9tp8cWbvF0z6ivhwlT1Hofq
                                         uDe7oyoCMaUuF5X3p1vr+laiReKWEkrjqVNVV0eeDsjoxyZZcnLFpjaBaa6k8rS7
                                         gz8tn8Yj62e3hqR0xy+ED+QSvfc/DCLBJXv8ULteuTxC3AKzJqvrSg5ds7iHZ3IQ
                                         j6WOAipHbHLNa8pQS6Bho8wNUpUiYloneCDdMaTJpZadTgX+cu37iQpzAEUruLMr
                                         eIDRRW1pdMYwdyrdTby/Y18kHemVVP0rUFTQPu4QB7EYMsE4/uJEFYGsTFXMfBh/
                                         8n08FQyvYiEQxJuN8JEkCybtchA3JS2oO5+LZRS7yh4tbaVMQWW5Oh+iJIVbBRRz
                                         07dhcWPq8CmM5PIbTdQaVtCcwD4QTXiy2TV4
                                         -----END CERTIFICATE-----';

SELECT CERTIFICATE_NAME, SUBJECT_DISTINGUISHED_NAME, ISSUER_DISTINGUISHED_NAME, ISSUER_COMMON_NAME
    FROM CERTIFICATES WHERE CERTIFICATE_NAME = 'DEMOROOTCA_CERT';


#清理
DROP USER TESTX509_TECHNICAL;
DROP PSE X509_PSE;
DROP CERTIFICATE DEMOROOTCA_CERT;
DROP CERTIFICATE X509_USER_CERT;
DROP X509 PROVIDER DEMO_X509_PROVIDER;

//添加
CREATE X509 PROVIDER DEMO_X509_PROVIDER WITH ISSUER 'SP=ON, CN=172.16.43.1';
SELECT * FROM X509_PROVIDERS;
CREATE PSE X509_PSE;
SELECT * FROM PSES;
ALTER PSE X509_PSE ADD CERTIFICATE DEMOROOTCA_CERT;
SELECT * FROM PSE_CERTIFICATES;
SET PSE X509_PSE PURPOSE X509 FOR PROVIDER DEMO_X509_PROVIDER;
SELECT * FROM PSES;
#创建用户
CREATE USER TESTX509_TECHNICAL WITH IDENTITY 'CN=172.16.43.1' FOR X509 PROVIDER DEMO_X509_PROVIDER SET USERGROUP DEFAULT;
SELECT * FROM USERS WHERE USER_NAME = 'TESTX509_TECHNICAL';
